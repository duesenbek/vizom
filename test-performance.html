<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChartTypeSelector Performance Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .performance-metric {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            padding: 1rem;
            border-left-width: 4px;
            border-left-style: solid;
        }
        
        .performance-metric.excellent {
            border-left-color: #10B981;
        }
        
        .performance-metric.good {
            border-left-color: #F59E0B;
        }
        
        .performance-metric.poor {
            border-left-color: #EF4444;
        }
        
        .test-running {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .mobile-simulator {
            width: 375px;
            height: 667px;
            border: 2px solid #333;
            border-radius: 20px;
            overflow: hidden;
            margin: 20px auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .mobile-viewport {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            background: white;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="test-container">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">
                <i class="fas fa-tachometer-alt mr-2"></i>
                ChartTypeSelector Performance Test Suite
            </h1>
            <p class="text-gray-600">
                Comprehensive testing for 60+ chart types, rapid clicking, and mobile performance
            </p>
        </header>

        <!-- Test Controls -->
        <section class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">
                <i class="fas fa-play-circle mr-2"></i>
                Test Controls
            </h2>
            
            <div class="flex flex-wrap gap-4 mb-4">
                <button id="run-all-tests" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-rocket mr-2"></i>
                    Run All Tests
                </button>
                
                <button id="run-large-dataset" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                    <i class="fas fa-database mr-2"></i>
                    Large Dataset (60+)
                </button>
                
                <button id="run-rapid-clicks" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                    <i class="fas fa-mouse-pointer mr-2"></i>
                    Rapid Clicks
                </button>
                
                <button id="run-mobile-test" class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors">
                    <i class="fas fa-mobile-alt mr-2"></i>
                    Mobile Test
                </button>
                
                <button id="clear-results" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                    <i class="fas fa-trash mr-2"></i>
                    Clear Results
                </button>
            </div>
            
            <div class="flex items-center gap-4">
                <label class="flex items-center">
                    <input type="checkbox" id="auto-scroll" class="mr-2" checked>
                    <span class="text-sm">Auto-scroll to results</span>
                </label>
                
                <label class="flex items-center">
                    <input type="checkbox" id="verbose-logging" class="mr-2">
                    <span class="text-sm">Verbose logging</span>
                </label>
            </div>
        </section>

        <!-- Live Test Status -->
        <section id="test-status" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 hidden">
            <div class="flex items-center">
                <div class="test-running mr-3">
                    <i class="fas fa-spinner fa-spin text-blue-600"></i>
                </div>
                <div>
                    <h3 class="font-semibold text-blue-900">Test Running</h3>
                    <p class="text-sm text-blue-700" id="current-test">Initializing...</p>
                </div>
            </div>
        </section>

        <!-- Test Results -->
        <section id="test-results" class="space-y-6">
            <h2 class="text-2xl font-semibold text-gray-900 mb-4">
                <i class="fas fa-chart-line mr-2"></i>
                Test Results
            </h2>
            
            <div id="results-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Results will be populated here -->
            </div>
        </section>

        <!-- Performance Charts -->
        <section id="performance-charts" class="mt-8 hidden">
            <h2 class="text-2xl font-semibold text-gray-900 mb-4">
                <i class="fas fa-chart-bar mr-2"></i>
                Performance Metrics
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="font-semibold mb-4">Render Times</h3>
                    <canvas id="render-chart"></canvas>
                </div>
                
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="font-semibold mb-4">Memory Usage</h3>
                    <canvas id="memory-chart"></canvas>
                </div>
            </div>
        </section>

        <!-- Mobile Simulator -->
        <section id="mobile-simulator" class="mt-8 hidden">
            <h2 class="text-2xl font-semibold text-gray-900 mb-4">
                <i class="fas fa-mobile-alt mr-2"></i>
                Mobile Testing Simulator
            </h2>
            
            <div class="mobile-simulator">
                <div class="mobile-viewport" id="mobile-viewport">
                    <!-- ChartTypeSelector will be rendered here -->
                </div>
            </div>
            
            <div class="text-center mt-4">
                <button id="test-mobile-scroll" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-arrows-alt-v mr-2"></i>
                    Test Mobile Scroll
                </button>
            </div>
        </section>
    </div>

    <!-- Import modules -->
    <script type="module">
        import { OptimizedChartTypeSelector } from './src/components/OptimizedChartTypeSelector.js';
        import { chartTypeSelectorTest } from './src/components/ChartTypeSelectorTest.js';

        // Test state
        let currentTest = null;
        let testResults = [];

        // DOM elements
        const runAllTestsBtn = document.getElementById('run-all-tests');
        const runLargeDatasetBtn = document.getElementById('run-large-dataset');
        const runRapidClicksBtn = document.getElementById('run-rapid-clicks');
        const runMobileTestBtn = document.getElementById('run-mobile-test');
        const clearResultsBtn = document.getElementById('clear-results');
        const testStatus = document.getElementById('test-status');
        const currentTestText = document.getElementById('current-test');
        const resultsContainer = document.getElementById('results-container');
        const autoScrollCheckbox = document.getElementById('auto-scroll');
        const verboseLoggingCheckbox = document.getElementById('verbose-logging');

        // Event listeners
        runAllTestsBtn.addEventListener('click', runAllTests);
        runLargeDatasetBtn.addEventListener('click', () => runSingleTest('large-dataset'));
        runRapidClicksBtn.addEventListener('click', () => runSingleTest('rapid-clicks'));
        runMobileTestBtn.addEventListener('click', () => runSingleTest('mobile'));
        clearResultsBtn.addEventListener('click', clearResults);

        // Test functions
        async function runAllTests() {
            showTestStatus('Running all performance tests...');
            clearResults();
            
            try {
                await chartTypeSelectorTest.runPerformanceTests();
                displayTestResults(chartTypeSelectorTest.testResults);
            } catch (error) {
                console.error('Test suite failed:', error);
                showError('Test suite failed: ' + error.message);
            } finally {
                hideTestStatus();
            }
        }

        async function runSingleTest(testType) {
            showTestStatus(`Running ${testType} test...`);
            
            try {
                switch (testType) {
                    case 'large-dataset':
                        await chartTypeSelectorTest.testLargeDatasetRendering();
                        break;
                    case 'rapid-clicks':
                        await chartTypeSelectorTest.testRapidClicking();
                        break;
                    case 'mobile':
                        await chartTypeSelectorTest.testMobileScrolling();
                        showMobileSimulator();
                        break;
                }
                
                const latestResult = chartTypeSelectorTest.testResults[chartTypeSelectorTest.testResults.length - 1];
                if (latestResult) {
                    addTestResultCard(latestResult);
                }
            } catch (error) {
                console.error('Test failed:', error);
                showError('Test failed: ' + error.message);
            } finally {
                hideTestStatus();
            }
        }

        function showTestStatus(message) {
            testStatus.classList.remove('hidden');
            currentTestText.textContent = message;
        }

        function hideTestStatus() {
            testStatus.classList.add('hidden');
        }

        function clearResults() {
            resultsContainer.innerHTML = '';
            testResults = [];
            document.getElementById('performance-charts').classList.add('hidden');
            document.getElementById('mobile-simulator').classList.add('hidden');
        }

        function displayTestResults(results) {
            resultsContainer.innerHTML = '';
            testResults = results;
            
            results.forEach(result => {
                addTestResultCard(result);
            });
            
            // Show performance charts
            showPerformanceCharts(results);
        }

        function addTestResultCard(result) {
            const card = document.createElement('div');
            const statusClass = result.passed ? 'excellent' : 'poor';
            const statusIcon = result.passed ? 'fa-check-circle' : 'fa-times-circle';
            const statusColor = result.passed ? 'text-green-600' : 'text-red-600';
            
            card.className = `performance-metric ${statusClass}`;
            card.innerHTML = `
                <div class="flex items-start justify-between mb-2">
                    <h3 class="font-semibold text-gray-900">
                        <i class="fas ${statusIcon} ${statusColor} mr-2"></i>
                        ${result.testName}
                    </h3>
                    <span class="text-sm ${statusColor} font-medium">
                        ${result.passed ? 'PASS' : 'FAIL'}
                    </span>
                </div>
                
                <div class="text-sm text-gray-600 mb-2">
                    ${result.recommendation}
                </div>
                
                <div class="grid grid-cols-2 gap-2 text-xs">
                    ${Object.keys(result)
                        .filter(key => !['testName', 'passed', 'recommendation', 'timestamp'].includes(key))
                        .map(key => `
                            <div>
                                <span class="font-medium">${key}:</span> 
                                <span class="text-gray-700">${result[key]}</span>
                            </div>
                        `).join('')}
                </div>
            `;
            
            resultsContainer.appendChild(card);
            
            // Auto-scroll if enabled
            if (autoScrollCheckbox.checked) {
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function showPerformanceCharts(results) {
            const chartsSection = document.getElementById('performance-charts');
            chartsSection.classList.remove('hidden');
            
            // Simple chart rendering (you could integrate Chart.js here)
            console.log('Performance charts would be rendered here with data:', results);
        }

        function showMobileSimulator() {
            const simulatorSection = document.getElementById('mobile-simulator');
            simulatorSection.classList.remove('hidden');
            
            // Initialize ChartTypeSelector in mobile viewport
            const mobileViewport = document.getElementById('mobile-viewport');
            const selector = new OptimizedChartTypeSelector(mobileViewport, {
                mobileColumns: 2,
                desktopColumns: 2,
                virtualScrolling: true
            });
            
            // Add scroll test functionality
            document.getElementById('test-mobile-scroll').addEventListener('click', () => {
                const scrollContainer = mobileViewport.querySelector('.virtual-scroll-wrapper');
                if (scrollContainer) {
                    // Smooth scroll to bottom and back
                    scrollContainer.scrollTo({
                        top: scrollContainer.scrollHeight,
                        behavior: 'smooth'
                    });
                    
                    setTimeout(() => {
                        scrollContainer.scrollTo({
                            top: 0,
                            behavior: 'smooth'
                        });
                    }, 2000);
                }
            });
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg mb-4';
            errorDiv.innerHTML = `
                <div class="flex items-center gap-2">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>${message}</span>
                </div>
            `;
            
            resultsContainer.appendChild(errorDiv);
        }

        // Initialize page
        console.log('ðŸš€ ChartTypeSelector Performance Test Suite loaded');
        console.log('Ready to run tests with 60+ chart types, rapid clicking, and mobile validation');
    </script>
</body>
</html>
