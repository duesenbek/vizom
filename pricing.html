<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIZOM - Pricing Plans | Choose Your Chart Generation Plan</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/images/vizom-icon.png">
    <link rel="apple-touch-icon" href="/images/vizom-icon.png">

    <!-- Inter font for unified typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS with Vizom brand config -->
    <script>
      window.tailwind = window.tailwind || {};
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'sans-serif'],
            },
            colors: {
              blue: {
                50:  '#F3F7FF',
                100: '#E1EDFF',
                200: '#C2D7FF',
                300: '#9ABFFF',
                400: '#5793FF',
                500: '#2E7BFF',
                600: '#0F6BFF',
                700: '#0852D6',
                800: '#0636A1',
                900: '#041C5C',
              },
            },
          },
        },
      };
    </script>
    <script src="https://cdn.tailwindcss.com?plugins=line-clamp"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- Shared vendor bundle: Chart.js, D3, Supabase auth/stripe -->
    <script type="module" src="src/app/vendor-loader.js"></script>
</head>
<body class="bg-slate-50 font-sans text-slate-800 antialiased">
  <script type="module" src="scripts/main.js"></script>

  <!-- Analytics Initialization and Pricing Events -->
  <script type="module">
    import { initializeAnalytics, trackEvent, trackPageview } from '/src/tracking/analytics.js';
    try { await initializeAnalytics(); trackPageview('/pricing'); } catch {}

    document.addEventListener('DOMContentLoaded', () => {
      // Billing toggle change
      const billingToggle = document.getElementById('billing-toggle');
      if (billingToggle) {
        const handler = () => {
          const isAnnual = billingToggle.querySelector('span')?.style.transform?.includes('1.5rem');
          trackEvent('pricing_billing_changed', { billing: isAnnual ? 'annual' : 'monthly' });
        };
        billingToggle.addEventListener('click', handler);
      }

      // Plan selection buttons
      document.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => {
          const card = btn.closest('.bg-white, .bg-blue-600');
          const planTitle = card?.querySelector('h3')?.textContent?.trim()?.toLowerCase();
          if (planTitle && (btn.textContent || '').trim().length > 0) {
            trackEvent('plan_selected', { plan: planTitle.includes('pro') ? 'pro' : (planTitle.includes('standard') ? 'standard' : planTitle) });
          }
        });
      });

      // FAQ interactions (robust selection without :contains)
      const faqSection = Array.from(document.querySelectorAll('section')).find(sec =>
        (sec.querySelector('h2')?.textContent || '').includes('Frequently Asked Questions')
      );
      if (faqSection) {
        faqSection.querySelectorAll('button').forEach(item => {
          item.addEventListener('click', () => {
            const question = item.querySelector('h3')?.textContent?.trim() || item.textContent?.trim();
            if (question) trackEvent('faq_clicked', { question });
          });
        });
      }
    });
  </script>

  <!-- Header -->
  <header class="sticky top-0 z-50 border-b border-slate-200 bg-white/80 backdrop-blur-lg">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <nav class="flex h-16 items-center justify-between">
        <a href="index.html" class="flex items-center gap-2.5">
          <img src="assets/images/logos/vizom-icon.png" alt="Vizom Logo" class="h-8 w-8">
          <span class="text-xl font-bold text-slate-900">VIZOM</span>
        </a>
        <!-- Desktop Navigation -->
        <div class="hidden items-center gap-8 md:flex">
          <a href="index.html" class="text-sm font-medium text-slate-600 transition-colors duration-200 hover:text-slate-900">Home</a>
          <a href="generator.html" class="text-sm font-medium text-slate-600 transition-colors duration-200 hover:text-slate-900">Generator</a>
          <a href="templates.html" class="text-sm font-medium text-slate-600 transition-colors duration-200 hover:text-slate-900">Templates</a>
          <a href="pricing.html" aria-current="page" class="text-sm font-medium text-blue-600 transition-colors duration-200 hover:text-blue-700">Pricing</a>
          <button class="inline-flex h-10 items-center justify-center whitespace-nowrap rounded-xl px-5 text-sm font-medium text-slate-600 transition-all hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 disabled:opacity-50" id="auth-signin" type="button">Sign In</button>
          <a href="generator.html" class="inline-flex h-10 items-center justify-center whitespace-nowrap rounded-xl bg-blue-600 px-5 text-sm font-medium text-white shadow-sm transition-all hover:bg-blue-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:opacity-50" data-action="get-started">Get Started</a>
        </div>
        <!-- Mobile Menu Toggle -->
        <button class="inline-flex h-10 w-10 items-center justify-center rounded-xl md:hidden" id="mobile-menu-toggle" aria-label="Toggle menu" aria-controls="mobile-menu" aria-expanded="false">
          <i class="fas fa-bars"></i>
        </button>
      </nav>
      <!-- Mobile Navigation -->
      <div class="hidden md:hidden" id="mobile-menu">
        <div class="space-y-2 py-4">
          <a href="index.html" class="block py-2 text-base font-medium text-slate-600 transition-colors duration-200 hover:text-slate-900">Home</a>
          <a href="generator.html" class="block py-2 text-base font-medium text-slate-600 transition-colors duration-200 hover:text-slate-900">Generator</a>
          <a href="templates.html" class="block py-2 text-base font-medium text-slate-600 transition-colors duration-200 hover:text-slate-900">Templates</a>
          <a href="pricing.html" aria-current="page" class="block py-2 text-base font-medium text-blue-600 transition-colors duration-200 hover:text-blue-700">Pricing</a>
        </div>
        <button class="inline-flex h-12 w-full items-center justify-center whitespace-nowrap rounded-xl bg-slate-100 px-6 text-sm font-medium text-slate-700 transition-all hover:bg-slate-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 disabled:opacity-50" id="auth-signin-mobile" type="button">Sign In</button>
        <a href="generator.html" class="inline-flex h-12 w-full items-center justify-center whitespace-nowrap rounded-xl bg-blue-600 px-6 text-sm font-medium text-white shadow-sm transition-all hover:bg-blue-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:opacity-50" data-action="get-started">Get Started</a>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="bg-white py-20 sm:py-24 lg:py-32">
    <div class="mx-auto max-w-7xl px-4 text-center sm:px-6 lg:px-8">
      <h1 class="text-4xl font-bold tracking-tight text-slate-900 sm:text-5xl">Choose Your Plan</h1>
      <p class="mx-auto mt-6 max-w-3xl text-lg leading-8 text-slate-600">
        Select the perfect plan for your data visualization needs. Start free and scale as you grow.
      </p>

      <!-- Billing Toggle -->
      <div class="mb-16 mt-8 flex items-center justify-center gap-4">
        <span class="text-sm font-medium text-slate-700">Monthly</span>
        <button class="relative inline-flex h-8 w-14 items-center rounded-full bg-slate-200 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" id="billing-toggle" role="switch" aria-checked="false" aria-label="Toggle billing interval">
          <span class="inline-block h-6 w-6 translate-x-1 transform rounded-full bg-white shadow-lg transition-transform"></span>
        </button>
        <span class="text-sm font-medium text-slate-700">Yearly <span class="font-semibold text-green-600">(Save 20%)</span></span>
      </div>
      <!-- Pricing Cards -->
      <div class="mx-auto mt-8 grid max-w-4xl grid-cols-1 gap-6 sm:grid-cols-2">
        <!-- Free Plan -->
        <div class="group flex flex-col rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition hover:shadow-md">
          <h3 class="text-lg font-semibold text-slate-900">Free</h3>
          <p class="mt-2 text-sm text-slate-600">For getting started.</p>
          <div class="mt-6 flex items-baseline gap-1">
            <span class="pricing-amount text-4xl font-bold text-slate-900">$0</span>
            <span class="text-slate-500">/mo</span>
          </div>
          <ul class="mt-6 space-y-2 text-sm text-slate-700">
            <li class="flex items-center gap-2"><i class="fas fa-check text-green-600"></i><span>Basic charts</span></li>
            <li class="flex items-center gap-2"><i class="fas fa-check text-green-600"></i><span>Limited exports</span></li>
            <li class="flex items-center gap-2"><i class="fas fa-check text-green-600"></i><span>Community support</span></li>
          </ul>
          <a href="generator.html" class="mt-8 inline-flex h-11 items-center justify-center rounded-xl bg-blue-600 px-4 text-sm font-medium text-white shadow-sm transition hover:bg-blue-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500">Get Started</a>
        </div>

        <!-- Pro Plan -->
        <div class="group flex flex-col rounded-2xl border border-blue-500 bg-white p-6 shadow-md ring-1 ring-blue-200 transition">
          <div class="mb-2 inline-flex items-center gap-2 rounded-full bg-blue-100 px-2.5 py-1 text-xs font-semibold text-blue-700">Most Popular</div>
          <h3 class="text-lg font-semibold text-slate-900">Pro</h3>
          <p class="mt-2 text-sm text-slate-600">For teams and power users.</p>
          <div class="mt-6 flex items-baseline gap-1">
            <span class="pricing-amount text-4xl font-bold text-slate-900">$2.99</span>
            <span class="text-slate-500">/mo</span>
          </div>
          <ul class="mt-6 space-y-2 text-sm text-slate-700">
            <li class="flex items-center gap-2"><i class="fas fa-check text-green-600"></i><span>All chart types</span></li>
            <li class="flex items-center gap-2"><i class="fas fa-check text-green-600"></i><span>Unlimited exports</span></li>
            <li class="flex items-center gap-2"><i class="fas fa-check text-green-600"></i><span>Priority support</span></li>
          </ul>
          <a href="generator.html" class="mt-8 inline-flex h-11 items-center justify-center rounded-xl bg-blue-600 px-4 text-sm font-medium text-white shadow-sm transition hover:bg-blue-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500" data-action="upgrade-pro">Upgrade to Pro</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="bg-white py-20 sm:py-24">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="mb-16 text-center">
        <h2 class="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">Everything you need to create stunning visualizations</h2>
        <p class="mx-auto mt-6 max-w-3xl text-lg leading-8 text-slate-600">Powerful features designed to help you turn data into insights</p>
      </div>
      <div class="mx-auto grid max-w-none grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3">
        <div class="flex gap-4">
          <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
            <i class="fas fa-chart-line text-blue-600 text-xl"></i>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-slate-900 mb-2">Advanced Charts</h3>
            <p class="text-slate-600">Create professional charts with advanced customization options</p>
          </div>
        </div>

        <div class="flex gap-4">
          <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
            <i class="fas fa-bolt text-green-600 text-xl"></i>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-slate-900 mb-2">AI-Powered</h3>
            <p class="text-slate-600">Smart AI assistance to help you create the perfect visualization</p>
          </div>
        </div>

        <div class="flex gap-4">
          <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0">
            <i class="fas fa-users text-purple-600 text-xl"></i>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-slate-900 mb-2">Team Collaboration</h3>
            <p class="text-slate-600">Invite your team and collaborate on charts in real-time</p>
          </div>
        </div>

        <div class="flex gap-4">
          <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center flex-shrink-0">
            <i class="fas fa-download text-orange-600 text-xl"></i>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-slate-900 mb-2">Multiple Export Formats</h3>
            <p class="text-slate-600">Export your charts in PNG, SVG, PDF, and more</p>
          </div>
        </div>

        <div class="flex gap-4">
          <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0">
            <i class="fas fa-shield-alt text-red-600 text-xl"></i>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-slate-900 mb-2">Secure & Private</h3>
            <p class="text-slate-600">Your data is encrypted and kept private</p>
          </div>
        </div>

        <div class="flex gap-4">
          <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center flex-shrink-0">
            <i class="fas fa-headset text-indigo-600 text-xl"></i>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-slate-900 mb-2">24/7 Support</h3>
            <p class="text-slate-600">Get help whenever you need it from our expert team</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  <section class="py-20 sm:py-24">
    <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
      <div class="mb-16 text-center">
        <h2 class="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">Frequently Asked Questions</h2>
        <p class="mt-6 text-lg leading-8 text-slate-600">Got questions? We've got answers.</p>
      </div>

      <div class="space-y-6">
        <div class="bg-white rounded-lg border border-slate-200 p-6">
          <button class="w-full text-left flex items-center justify-between gap-4" aria-expanded="false">
            <h3 class="text-lg font-semibold text-slate-900">Can I change my plan later?</h3>
            <i class="fas fa-chevron-down text-slate-400 transform transition-transform"></i>
          </button>
          <p class="text-slate-600 mt-4 hidden">
            Yes, you can upgrade or downgrade your plan at any time. Changes will be reflected in your next billing cycle.
          </p>
        </div>

        <div class="bg-white rounded-lg border border-slate-200 p-6">
          <button class="w-full text-left flex items-center justify-between gap-4" aria-expanded="false">
            <h3 class="text-lg font-semibold text-slate-900">Do you offer a free trial?</h3>
            <i class="fas fa-chevron-down text-slate-400 transform transition-transform"></i>
          </button>
          <p class="text-slate-600 mt-4 hidden">
            Yes! We offer a 14-day free trial for our Professional plan with full access to all features.
          </p>
        </div>

        <div class="bg-white rounded-lg border border-slate-200 p-6">
          <button class="w-full text-left flex items-center justify-between gap-4" aria-expanded="false">
            <h3 class="text-lg font-semibold text-slate-900">What payment methods do you accept?</h3>
            <i class="fas fa-chevron-down text-slate-400 transform transition-transform"></i>
          </button>
          <p class="text-slate-600 mt-4 hidden">
            We accept all major credit cards, PayPal, and wire transfers for Enterprise plans.
          </p>
        </div>

        <div class="bg-white rounded-lg border border-slate-200 p-6">
          <button class="w-full text-left flex items-center justify-between gap-4" aria-expanded="false">
            <h3 class="text-lg font-semibold text-slate-900">Is my data secure?</h3>
            <i class="fas fa-chevron-down text-slate-400 transform transition-transform"></i>
          </button>
          <p class="text-slate-600 mt-4 hidden">
            Absolutely. We use industry-standard encryption and security measures to protect your data.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="bg-slate-900 py-20 sm:py-24">
    <div class="mx-auto max-w-7xl px-4 text-center sm:px-6 lg:px-8">
      <h2 class="text-3xl font-bold tracking-tight text-white sm:text-4xl">Ready to get started?</h2>
      <p class="mx-auto mt-6 max-w-2xl text-lg leading-8 text-slate-300">Join thousands of users who are already creating beautiful data visualizations with VIZOM.</p>
      <div class="mt-10 flex items-center justify-center gap-4">
        <button class="inline-flex h-12 items-center justify-center gap-2 whitespace-nowrap rounded-xl bg-white px-6 text-sm font-medium text-slate-700 shadow-sm ring-1 ring-inset ring-slate-200 transition-all hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500" data-action="upgrade-pro">Start Free Trial</button>
        <button class="inline-flex h-12 items-center justify-center gap-2 whitespace-nowrap rounded-xl bg-blue-600 px-6 text-sm font-medium text-white shadow-sm transition-all hover:bg-blue-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2" data-action="upgrade-pro">Schedule Demo</button>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-slate-900 text-slate-300">
    <div class="mx-auto max-w-7xl px-4 py-16 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 gap-8 lg:grid-cols-4">
        <div class="lg:col-span-2">
          <div class="flex items-center gap-2.5">
            <img src="assets/images/logos/vizom-icon.png" alt="Vizom Logo" class="h-8 w-8">
            <span class="text-xl font-bold text-white">VIZOM</span>
          </div>
          <p class="mt-4 text-sm text-slate-400">
            AI-powered visual engine. Create beautiful visualizations in seconds.
          </p>
        </div>
        <div>
          <h4 class="text-sm font-semibold text-white">Product</h4>
          <ul class="mt-4 space-y-3">
            <li><a href="generator.html" class="text-sm text-slate-400 transition-colors hover:text-white">Generator</a></li>
            <li><a href="templates.html" class="text-sm text-slate-400 transition-colors hover:text-white">Templates</a></li>
            <li><a href="pricing.html" class="text-sm text-slate-400 transition-colors hover:text-white">Pricing</a></li>
          </ul>
        </div>
        <div>
          <h4 class="text-sm font-semibold text-white">Resources</h4>
          <ul class="mt-4 space-y-3">
            <li><a href="docs.html" class="text-sm text-slate-400 transition-colors hover:text-white">Documentation</a></li>
            <li><a href="docs.html#api" class="text-sm text-slate-400 transition-colors hover:text-white">API Reference</a></li>
            <li><a href="blog.html" class="text-sm text-slate-400 transition-colors hover:text-white">Blog</a></li>
          </ul>
        </div>
        <div>
          <h4 class="text-sm font-semibold text-white">Company</h4>
          <ul class="mt-4 space-y-3">
            <li><a href="about.html" class="text-sm text-slate-400 transition-colors hover:text-white">About</a></li>
            <li><a href="about.html#careers" class="text-sm text-slate-400 transition-colors hover:text-white">Careers</a></li>
            <li><a href="contact.html" class="text-sm text-slate-400 transition-colors hover:text-white">Contact</a></li>
          </ul>
        </div>
      </div>
      <div class="mt-10 border-t border-slate-800 pt-8 text-center">
        <p class="text-sm text-slate-400">&copy; 2025 VIZOM. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const billingToggle = document.getElementById('billing-toggle');
      if (!billingToggle) return;

      const prices = {
        monthly: ['$0', '$2.99'],
        yearly: ['$0', '$2.39'],
      };

      const updatePrices = (isYearly) => {
        const priceElements = document.querySelectorAll('.pricing-amount');
        const targetPrices = isYearly ? prices.yearly : prices.monthly;
        priceElements.forEach((el, index) => {
          if (index < targetPrices.length) {
            el.textContent = targetPrices[index];
          }
        });
      };

      // Initialize state on load
      const initialIsYearly = billingToggle.getAttribute('aria-checked') === 'true';
      const thumb = billingToggle.querySelector('span');
      updatePrices(initialIsYearly);
      if (initialIsYearly) {
        thumb.style.transform = 'translateX(1.5rem)';
      }

      billingToggle.addEventListener('click', () => {
        const isChecked = billingToggle.getAttribute('aria-checked') === 'true';
        const newState = !isChecked;
        billingToggle.setAttribute('aria-checked', String(newState));
        const thumb = billingToggle.querySelector('span');
        thumb.style.transform = newState ? 'translateX(1.5rem)' : 'translateX(0)';
        updatePrices(newState);
      });
    });
  </script>

  <!-- FAQ Toggle Script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const faqSection = Array.from(document.querySelectorAll('section')).find(sec =>
        (sec.querySelector('h2')?.textContent || '').includes('Frequently Asked Questions')
      );
      if (!faqSection) return;
      faqSection.querySelectorAll('button[aria-expanded]')?.forEach(btn => {
        btn.addEventListener('click', () => {
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          btn.setAttribute('aria-expanded', String(!expanded));
          const answer = btn.parentElement?.querySelector('p');
          if (answer) answer.classList.toggle('hidden');
          const icon = btn.querySelector('i');
          if (icon) icon.classList.toggle('rotate-180');
        });
      });
    });
  </script>
  
  <!-- Mobile Menu Script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const menuToggle = document.getElementById('mobile-menu-toggle');
      const mobileMenu = document.getElementById('mobile-menu');
      if (!menuToggle || !mobileMenu) return;
      const icon = menuToggle.querySelector('i');

      const toggleMenu = () => {
        const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
        menuToggle.setAttribute('aria-expanded', String(!isExpanded));
        mobileMenu.classList.toggle('hidden');
        if (icon) {
          icon.classList.toggle('fa-bars');
          icon.classList.toggle('fa-times');
        }
      };

      menuToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleMenu();
      });

      document.addEventListener('click', (e) => {
        if (!mobileMenu.classList.contains('hidden') && !mobileMenu.contains(e.target) && !menuToggle.contains(e.target)) {
          toggleMenu();
        }
      });

      mobileMenu.querySelectorAll('a, button').forEach(link => {
        link.addEventListener('click', () => {
          if (!mobileMenu.classList.contains('hidden')) toggleMenu();
        });
      });
    });
  </script>

  <!-- Upgrade Modal -->
  <div id="upgrade-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-xl max-w-md w-full p-6 text-center space-y-4">
      <h3 class="text-xl font-semibold text-slate-900">Upgrade to Pro</h3>
      <p class="text-slate-600">To upgrade, please email us with your account email at:</p>
      <div class="relative bg-slate-100 rounded-lg p-3">
          <code class="text-blue-600 font-mono">billing@vizom.com</code>
          <button id="copy-email-button" class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 hover:text-blue-600 p-1.5 rounded-md transition">
              <i class="fas fa-copy"></i>
          </button>
      </div>
      <p id="copy-success-toast" class="text-sm text-green-600 hidden">Email copied! We'll contact you within 24h.</p>
      <button id="close-upgrade-modal" class="mt-4 w-full inline-flex items-center justify-center gap-2 bg-slate-100 text-slate-700 px-4 py-3 rounded-lg hover:bg-slate-200 transition">Close</button>
    </div>
  </div>

  <script type="module">
    import { startCheckout } from '/src/payments/stripe-client.js';
    import { trackEvent } from '/src/tracking/analytics.js';
    import { showLoading as showGlobalLoading, hideLoading as hideGlobalLoading, showToast as showGlobalToast } from '/scripts/core/ui-feedback.js';

    // TODO: Configure STRIPE_SECRET_KEY / STRIPE_PRICE_ID on the server (Netlify/Supabase env vars).
    //       Never expose Stripe secret keys in frontend code.

    const noop = () => {};
    const feedback = {
      showLoading: showGlobalLoading || noop,
      hideLoading: hideGlobalLoading || noop,
      showToast: showGlobalToast || ((message, type) => console.info('[toast]', type || 'info', message))
    };

    const USD_PRICE_REGEX = /^\$\d+(?:\.\d{2})?$/;

    function getProPriceText() {
      const priceEls = document.querySelectorAll('.pricing-amount');
      const proEl = priceEls[1] || null; // second price corresponds to Pro plan
      return (proEl?.textContent || '').trim();
    }

    function validateUsdPrices() {
      const priceEls = Array.from(document.querySelectorAll('.pricing-amount'));
      let allValid = true;

      for (const el of priceEls) {
        const raw = (el.textContent || '').trim();
        if (!raw || !raw.startsWith('$')) continue; // only validate USD-like prices

        const normalized = raw.replace(/\s+/g, '');
        const hasComma = normalized.includes(',');
        const usesValidFormat = USD_PRICE_REGEX.test(normalized);

        if (hasComma || !usesValidFormat) {
          allValid = false;
        }
      }

      if (!allValid) {
        feedback.showToast('Pricing format error: use "." for USD decimals (example: $2.99).', 'error');
        console.error('[pricing] Invalid USD price format detected in .pricing-amount elements');
      }

      return allValid;
    }

    document.addEventListener('DOMContentLoaded', () => {
      const upgradeModal = document.getElementById('upgrade-modal');
      const closeUpgradeModalBtn = document.getElementById('close-upgrade-modal');
      const copyEmailBtn = document.getElementById('copy-email-button');
      const successToast = document.getElementById('copy-success-toast');
      const upgradeButtons = document.querySelectorAll('[data-action="upgrade-pro"]');
      const billingToggle = document.getElementById('billing-toggle');

      // Initial validation of displayed prices and on billing toggle changes
      validateUsdPrices();
      if (billingToggle) {
        billingToggle.addEventListener('click', () => {
          // Defer so the existing toggle script can update prices first
          setTimeout(() => validateUsdPrices(), 0);
        });
      }

      // Stripe Checkout binding for Upgrade buttons
      upgradeButtons.forEach((btn) => {
        btn.addEventListener('click', async (event) => {
          // Capture-phase listener to avoid double-binding with global Stripe handlers
          event.preventDefault();
          event.stopPropagation();
          if (typeof event.stopImmediatePropagation === 'function') {
            event.stopImmediatePropagation();
          }

          if (!validateUsdPrices()) {
            return;
          }

          const priceText = getProPriceText();
          const isYearly = billingToggle?.getAttribute('aria-checked') === 'true';

          try {
            feedback.showLoading('Redirecting to secure Stripe Checkout…', 'Upgrade to Pro');

            trackEvent('upgrade_clicked', {
              plan: 'pro',
              source: 'pricing',
              billing_interval: isYearly ? 'yearly' : 'monthly',
              price_usd: priceText,
            });

            await startCheckout('pro');
          } finally {
            feedback.hideLoading();
          }
        }, { capture: true });
      });

      // Keep email copy modal as a fallback/help utility (not primary upgrade path)
      if (upgradeModal && closeUpgradeModalBtn && copyEmailBtn && successToast) {
        const hideModal = () => {
          upgradeModal.classList.add('hidden');
          successToast.classList.add('hidden');
        };

        closeUpgradeModalBtn.addEventListener('click', hideModal);
        upgradeModal.addEventListener('click', (e) => {
          if (e.target === upgradeModal) hideModal();
        });

        copyEmailBtn.addEventListener('click', () => {
          navigator.clipboard.writeText('billing@vizom.com').then(() => {
            successToast.classList.remove('hidden');
            feedback.showToast('Email copied to clipboard ✅', 'success');
            setTimeout(() => successToast.classList.add('hidden'), 3000);
          }).catch(() => {
            feedback.showToast('Failed to copy email. Please try again.', 'error');
          });
        });
      }
    });
  </script>
</body>
</html>
