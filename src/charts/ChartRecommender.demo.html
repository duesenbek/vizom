<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chart Recommender Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-white min-h-screen p-8">
  <div class="max-w-4xl mx-auto">
    <header class="mb-8">
      <h1 class="text-3xl font-bold text-blue-900 mb-2">AI Chart Recommender</h1>
      <p class="text-blue-700">Get intelligent chart type suggestions based on your data visualization needs</p>
    </header>
    
    <main>
      <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
        <div class="mb-4">
          <label for="prompt-input" class="block text-sm font-medium text-gray-700 mb-2">
            Describe what you want to visualize:
          </label>
          <textarea
            id="prompt-input"
            rows="3"
            class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="e.g., Show conversion rate by channel for each month"
          ></textarea>
        </div>
        
        <div class="flex gap-4">
          <button
            id="recommend-btn"
            class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2"
          >
            <i data-lucide="sparkles" class="w-4 h-4"></i>
            Get Recommendation
          </button>
          
          <button
            id="clear-btn"
            class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
          >
            Clear
          </button>
        </div>
      </div>
      
      <!-- Loading State -->
      <div id="loading" class="hidden bg-white rounded-lg shadow-sm p-12 text-center">
        <div class="inline-flex items-center gap-2 text-blue-500">
          <svg class="animate-spin w-5 h-5" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <span>Analyzing your request...</span>
        </div>
      </div>
      
      <!-- Results -->
      <div id="results" class="hidden space-y-6">
        <!-- Primary Recommendation -->
        <div class="bg-white rounded-lg shadow-sm p-6 border-2 border-blue-500">
          <div class="flex items-center gap-2 mb-4">
            <i data-lucide="star" class="w-5 h-5 text-blue-500"></i>
            <h2 class="text-xl font-semibold text-gray-900">Primary Recommendation</h2>
          </div>
          
          <div id="primary-result" class="space-y-4">
            <!-- Content will be inserted here -->
          </div>
        </div>
        
        <!-- Alternatives -->
        <div class="bg-white rounded-lg shadow-sm p-6">
          <div class="flex items-center gap-2 mb-4">
            <i data-lucide="layers" class="w-5 h-5 text-gray-500"></i>
            <h2 class="text-xl font-semibold text-gray-900">Alternative Options</h2>
          </div>
          
          <div id="alternatives-result" class="grid md:grid-cols-2 gap-4">
            <!-- Content will be inserted here -->
          </div>
        </div>
        
        <!-- Raw JSON -->
        <div class="bg-gray-900 rounded-lg p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-sm font-medium text-gray-300">Raw API Response</h3>
            <button
              id="copy-json-btn"
              class="px-3 py-1 bg-gray-700 text-gray-300 text-sm rounded hover:bg-gray-600 transition-colors"
            >
              Copy JSON
            </button>
          </div>
          <pre id="json-output" class="text-xs text-gray-400 overflow-x-auto"></pre>
        </div>
      </div>
      
      <!-- Example Prompts -->
      <div class="bg-white rounded-lg shadow-sm p-6 mt-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Example Prompts</h3>
        <div class="grid md:grid-cols-2 gap-3">
          <button class="example-prompt text-left p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors text-sm">
            Show sales trend over the last 12 months
          </button>
          <button class="example-prompt text-left p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors text-sm">
            Compare revenue by product category
          </button>
          <button class="example-prompt text-left p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors text-sm">
            Show distribution of customer ages
          </button>
          <button class="example-prompt text-left p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors text-sm">
            Show relationship between ad spend and revenue
          </button>
          <button class="example-prompt text-left p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors text-sm">
            Show breakdown of expenses by department
          </button>
          <button class="example-prompt text-left p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors text-sm">
            Show conversion rate by channel for each month
          </button>
        </div>
      </div>
    </main>
  </div>
  
  <script type="module">
    import { chartRecommender } from './ChartRecommender.js';
    
    // Initialize Lucide icons
    lucide.createIcons();
    
    // DOM elements
    const promptInput = document.getElementById('prompt-input');
    const recommendBtn = document.getElementById('recommend-btn');
    const clearBtn = document.getElementById('clear-btn');
    const loading = document.getElementById('loading');
    const results = document.getElementById('results');
    const primaryResult = document.getElementById('primary-result');
    const alternativesResult = document.getElementById('alternatives-result');
    const jsonOutput = document.getElementById('json-output');
    const copyJsonBtn = document.getElementById('copy-json-btn');
    
    // Example prompts
    const examplePrompts = document.querySelectorAll('.example-prompt');
    
    // Get chart type info
    function getChartTypeInfo(typeId) {
      const { getChartTypeById } = import('./chart-types.js');
      return getChartTypeById(typeId);
    }
    
    // Render recommendation
    function renderRecommendation(recommendation) {
      const { primary, alternatives } = recommendation;
      
      // Render primary
      const primaryType = getChartTypeInfo(primary.type);
      primaryResult.innerHTML = `
        <div class="flex items-center gap-4">
          <div class="text-3xl">${primaryType?.icon || 'ðŸ“Š'}</div>
          <div class="flex-1">
            <h3 class="text-lg font-medium text-gray-900 capitalize">${primary.type.replace('-', ' ')}</h3>
            <p class="text-gray-600 text-sm mt-1">${primaryType?.description || ''}</p>
          </div>
          <div class="text-right">
            <div class="text-2xl font-bold text-blue-500">${Math.round(primary.confidence * 100)}%</div>
            <div class="text-xs text-gray-500">Confidence</div>
          </div>
        </div>
        <div class="mt-4 p-3 bg-blue-50 rounded-lg">
          <p class="text-sm text-blue-800">${primary.reasoning}</p>
        </div>
      `;
      
      // Render alternatives
      alternativesResult.innerHTML = alternatives.map(alt => {
        const altType = getChartTypeInfo(alt.type);
        return `
          <div class="border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors">
            <div class="flex items-center gap-3">
              <div class="text-2xl">${altType?.icon || 'ðŸ“Š'}</div>
              <div class="flex-1">
                <h4 class="font-medium text-gray-900 capitalize">${alt.type.replace('-', ' ')}</h4>
                <p class="text-xs text-gray-600 mt-1">${altType?.description || ''}</p>
              </div>
              <div class="text-right">
                <div class="text-lg font-semibold text-gray-700">${Math.round(alt.confidence * 100)}%</div>
              </div>
            </div>
            <div class="mt-3 p-2 bg-gray-50 rounded text-xs text-gray-700">
              ${alt.reasoning}
            </div>
          </div>
        `;
      }).join('');
      
      // Show raw JSON
      jsonOutput.textContent = JSON.stringify(recommendation, null, 2);
      
      // Re-initialize icons
      lucide.createIcons();
    }
    
    // Handle recommendation
    async function getRecommendation() {
      const prompt = promptInput.value.trim();
      
      if (!prompt) {
        alert('Please enter a prompt');
        return;
      }
      
      // Show loading
      loading.classList.remove('hidden');
      results.classList.add('hidden');
      
      // Simulate API delay
      await new Promise(resolve => setTimeout(resolve, 500));
      
      try {
        const recommendation = chartRecommender.recommend(prompt);
        
        // Hide loading, show results
        loading.classList.add('hidden');
        results.classList.remove('hidden');
        
        renderRecommendation(recommendation);
        
      } catch (error) {
        loading.classList.add('hidden');
        alert('Error getting recommendation: ' + error.message);
      }
    }
    
    // Event listeners
    recommendBtn.addEventListener('click', getRecommendation);
    
    promptInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && e.ctrlKey) {
        getRecommendation();
      }
    });
    
    clearBtn.addEventListener('click', () => {
      promptInput.value = '';
      results.classList.add('hidden');
      loading.classList.add('hidden');
    });
    
    copyJsonBtn.addEventListener('click', () => {
      navigator.clipboard.writeText(jsonOutput.textContent);
      copyJsonBtn.textContent = 'Copied!';
      setTimeout(() => {
        copyJsonBtn.textContent = 'Copy JSON';
      }, 2000);
    });
    
    examplePrompts.forEach(btn => {
      btn.addEventListener('click', () => {
        promptInput.value = btn.textContent.trim();
        getRecommendation();
      });
    });
    
    // Initialize with a sample
    promptInput.value = 'Show conversion rate by channel for each month';
  </script>
</body>
</html>
